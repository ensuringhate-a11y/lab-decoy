<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Document — Viewer (Demo)</title>
  <style>
    :root {
      --bg: #0b0c10;
      --card: #111318;
      --muted: #a6adbb;
      --text: #e7eaf0;
      --accent: #1a73e8;
      --ok: #20c997;
      --warn: #ffb020;
      --err: #ff6b6b;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 16px;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body { margin: 0; background: radial-gradient(1200px 600px at 60% -10%, #1b1e27 0%, #0b0c10 60%); color: var(--text); font: 15px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji"; }
    .topbar { position: sticky; top: 0; display: flex; align-items: center; gap: 12px; padding: 14px 18px; background: rgba(13,16,23,.8); backdrop-filter: blur(8px); border-bottom: 1px solid rgba(255,255,255,.06); }
    .logo { width: 26px; height: 26px; border-radius: 6px; display: grid; place-items: center; background: #1a73e8; box-shadow: var(--shadow); font-weight: 800; color: white; letter-spacing: .3px; }
    .brand { font-weight: 700; opacity: .85 }
    .wrap { max-width: 960px; margin: 36px auto; padding: 0 16px; }
    .doc-card { background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.008)); border: 1px solid rgba(255,255,255,.08); border-radius: var(--radius); box-shadow: var(--shadow); padding: 22px; display: grid; gap: 16px; }
    .doc-head { display: flex; align-items: center; gap: 14px; }
    .doc-icon { width: 44px; height: 56px; border-radius: 8px; background: #e8f0fe; color: #1a73e8; display: grid; place-items: center; font-weight: 800; box-shadow: inset 0 -8px 16px rgba(26,115,232,.08); }
    .doc-title { font-size: 18px; font-weight: 700; }
    .doc-meta { color: var(--muted); font-size: 13px; }
    .actions { display: flex; flex-wrap: wrap; gap: 10px; }
    .btn { appearance: none; border: 1px solid rgba(255,255,255,.14); padding: 12px 16px; border-radius: 12px; background: #151923; color: var(--text); font-weight: 600; cursor: pointer; transition: .2s ease; box-shadow: var(--shadow); }
    .btn:hover { transform: translateY(-1px); border-color: rgba(255,255,255,.28) }
    .btn.primary { background: var(--accent); border-color: transparent; }
    .btn.primary:hover { filter: brightness(1.05) }
    .btn.ghost { background: transparent; }
    .notice { padding: 12px 14px; border-radius: 12px; font-size: 14px; }
    .notice.ok { background: rgba(32,201,151,.08); border: 1px solid rgba(32,201,151,.25); color: #a8f1d6 }
    .notice.warn { background: rgba(255,176,32,.08); border: 1px solid rgba(255,176,32,.25); color: #ffe2a8 }
    .log { margin-top: 8px; background: #0f1116; border: 1px dashed rgba(255,255,255,.12); padding: 12px; border-radius: 12px; max-height: 180px; overflow: auto; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size: 12.5px; color: #cbd5e1; }
    .muted { color: var(--muted) }
    footer { opacity: .6; text-align: center; margin: 28px 0 40px; font-size: 13px; }
    code.k { background: rgba(255,255,255,.08); padding: 2px 6px; border-radius: 6px; }
  </style>
</head>
<body>
  <div class="topbar">
    <div class="logo">D</div>
    <div class="brand">Docs • Viewer</div>
  </div>
  <main class="wrap">
    <section class="doc-card">
      <div class="doc-head">
        <div class="doc-icon">DOC</div>
        <div>
          <div class="doc-title" id="docTitle">Quarterly Report — Demo</div>
          <div class="doc-meta" id="docMeta">Size: ~2 KB • Updated: today</div>
        </div>
      </div>
      <div class="notice warn">
        Demonstration page for a lab. The file is generated on the client and is <strong>harmless</strong> (plain text .txt). No auto-downloads.
      </div>
      <div class="actions">
        <button class="btn ghost" id="btnView">Preview</button>
        <button class="btn primary" id="btnDownload">Download demo</button>
      </div>
      <div class="log" id="log"></div>
    </section>
    <footer class="muted">Lab template. To embed into Google Sites use <code class="k">Insert → By URL</code> (iframe).</footer>
  </main>
  <script>
    const JSON_URL = "";
    const FALLBACK_JSON = {
      filename: "Report-Demo.txt",
      mime: "text/plain",
      note: "Harmless lab file (demo). No executable data.",
      content: "This is a harmless demo file for a lab exercise. You can attach it to your report as an artifact of the download.

Flow: email → decoy page → JSON request → local file generation → manual save by the user.
"
    };
    const logEl = document.getElementById('log');
    function log(msg) {
      const t = new Date().toLocaleTimeString();
      logEl.innerHTML += `[${t}] ${msg}
`;
      logEl.scrollTop = logEl.scrollHeight;
    }
    const state = { meta: null };
    async function fetchMeta() {
      if (!JSON_URL) {
        log("JSON_URL is empty — using local safe data.");
        state.meta = FALLBACK_JSON;
        return FALLBACK_JSON;
      }
      try {
        log("Requesting JSON metadata…");
        const res = await fetch(JSON_URL, { credentials: 'omit', mode: 'cors' });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();
        if (!data || typeof data.filename !== 'string' || typeof data.mime !== 'string') {
          throw new Error('Invalid JSON format, using fallback.');
        }
        state.meta = data;
        log("JSON received.");
        return data;
      } catch (err) {
        log(`Failed to fetch JSON (${err.message}). Using safe fallback.`);
        state.meta = FALLBACK_JSON;
        return FALLBACK_JSON;
      }
    }
    function downloadFromMeta(meta) {
      const text = String(meta.content ?? "Demo file");
      const blob = new Blob([text], { type: meta.mime || 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = meta.filename || 'Report-Demo.txt';
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
      log(`Download started: ${a.download}`);
    }
    document.getElementById('btnView').addEventListener('click', async () => {
      const meta = state.meta || await fetchMeta();
      log(`Preview metadata: filename=\"${meta.filename}\", mime=\"${meta.mime}\"`);
      if (meta.note) log(`Note: ${meta.note}`);
      document.getElementById('docTitle').textContent = meta.filename.replace(/\.[^/.]+$/, '') + ' — Demo';
      document.getElementById('docMeta').textContent = `Type: ${meta.mime} • Source: JSON (${JSON_URL ? 'remote' : 'local fallback'})`;
    });
    document.getElementById('btnDownload').addEventListener('click', async () => {
      const meta = state.meta || await fetchMeta();
      downloadFromMeta(meta);
    });
    log('Ready. Click “Preview” to request JSON or “Download demo” to retrieve a safe file.');
  </script>
</body>
</html>

